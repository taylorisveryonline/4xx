<!doctype html> 
<meta charset = "utf-8"> 
<title>Marbles</title>
<body>
<script src="ga.js"></script>
<!-- TODO: remove sample and reference below once we have real levels -->
<script src="levels/sample.js"></script>
<script src="plugins.js"></script>
<script>

/*
This file requires these convenience functions from `plugins.js`:
`random`
`grid`
`move`
`contain`
`circleCollision`
`multipleCircleCollision`
`angle`
`distance`
*/

// Create a new GA instance, and start it.
var g = ga(512, 512, setup, ["images/marbles.png"]); // this is the spritesheet!
g.start();

//Declare global sprites, objects, and variables here:
var sling, marbles, capturedMarble, wall, tile, rowHeight, wallHeight, collisions;

// Setup function for initialization tasks
function setup() {
  collisions = [];
  wallHeight = 10;
  g.backgroundColor = "#000"; // black background
  g.canvas.style.border = "1px black dashed";
  for (let i = 0; i < sampleLevel.length; i++) {
    let row = sampleLevel[i];
    for (let j = 0; j < row.length; j++) {
      tile = row[j];
      if (tile === '0' || tile === 'W') {
        wall = g.rectangle(wallHeight, wallHeight * 2, "red");
        // row height in pixels
        wall.setPosition(j * wallHeight, i * (wallHeight * 2));
        collisions.push(wall);
      }
    }
  }

  // Change the state to `play` after everything is set up
  g.state = play;  
}

//The `play` function will run in a loop
function play() {
  // console.log('game loop is loopin');

  // check for wall collisions 
  collisions.forEach(function(wall, i) {
    var boxCollision = g.hit(g.pointer, wall);
    if (boxCollision) {
      console.log('hit wall ' + i);
    }
  });
}
 
</script>
</body>

